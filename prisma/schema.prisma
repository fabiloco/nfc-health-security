generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model user {
  id         Int       @id @default(autoincrement())
  email      String    @unique
  password   String
  person     person[]
  created_at DateTime  @default(now())
  updated_at DateTime  @updatedAt
  deleted_at DateTime? @db.Timestamp(0)
  role       role      @default(PATIENT)
  nfc        nfc[]
}

enum role {
  ADMIN
  PATIENT
  DOCTOR
}

model person {
  id             Int                    @id @default(autoincrement())
  dni            String                 @unique
  name           String
  lastname       String?
  phone          String?
  ocupation      String?
  sex            person_sex?
  marital_status person_marital_status?
  address        String?
  blood_type     String?
  height         String?
  religion       String?
  education      String?
  sisben         String?
  estrato        String?
  birthday       DateTime?              @db.Timestamp(0)
  deleted_at     DateTime?              @db.Timestamp(0)
  allergies      person_allergies[]
  appointment    appointment[]
  contacts       contact[]
  doctors        doctor[]
  user           user                   @relation(fields: [user_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  user_id        Int
  conditions     condition[]
  medications    medication[]
  created_at     DateTime               @default(now())
  updated_at     DateTime               @updatedAt
}

model nfc {
  id      Int    @id @default(autoincrement())
  token   String @db.LongText
  user    user   @relation(fields: [user_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  user_id Int
}

model allergies {
  id               Int                @id @default(autoincrement())
  name             String
  description      String             @db.LongText
  person_allergies person_allergies[]
  created_at       DateTime           @default(now())
  updated_at       DateTime           @updatedAt
}

model condition {
  id             Int      @id @default(autoincrement())
  name           String
  description    String   @db.LongText
  diagnosis_date DateTime
  created_at     DateTime @default(now())
  updated_at     DateTime @updatedAt
  person         person?  @relation(fields: [personId], references: [id])
  personId       Int?
}

model medication {
  id          Int      @id @default(autoincrement())
  name        String
  description String   @db.LongText
  reason      String   @db.LongText
  dosage      String
  frecuency   String
  start_date  DateTime
  end_date    DateTime
  created_at  DateTime @default(now())
  updated_at  DateTime @updatedAt
  person      person?  @relation(fields: [personId], references: [id])
  personId    Int?
}

model person_allergies {
  id           Int       @id @default(autoincrement())
  description  String?   @db.LongText
  allergies    allergies @relation(fields: [allergies_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  allergies_id Int
  person       person    @relation(fields: [person_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  person_id    Int
  created_at   DateTime  @default(now())
  updated_at   DateTime  @updatedAt
}

model appointment {
  id          Int                  @id @default(autoincrement())
  start_day   DateTime?            @db.Timestamp(0)
  reason      String               @db.Text
  description String               @db.LongText
  hospital    String
  address     String
  severity    String
  city        String
  person      person               @relation(fields: [person_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  person_id   Int
  doctor      doctor_appointment[]
  created_at  DateTime             @default(now())
  updated_at  DateTime             @updatedAt
}

model doctor_appointment {
  id             Int         @id @default(autoincrement())
  appointment    appointment @relation(fields: [appointment_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  appointment_id Int
  doctor         doctor      @relation(fields: [doctor_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  doctor_id      Int
  created_at     DateTime    @default(now())
  updated_at     DateTime    @updatedAt
}

model contact {
  id         Int       @id @default(autoincrement())
  contact_id Int
  person     person    @relation(fields: [person_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  person_id  Int
  created_at DateTime  @default(now())
  updated_at DateTime  @updatedAt
  deleted_at DateTime? @db.Timestamp(0)
}

model doctor_urgency {
  id           Int      @id @default(autoincrement())
  urgencias_id Int
  doctor_id    Int
  doctors      doctor   @relation(fields: [doctor_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  urgencias    urgency  @relation(fields: [urgencias_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  created_at   DateTime @default(now())
  updated_at   DateTime @updatedAt
}

model doctor {
  id                   Int                  @id @default(autoincrement())
  professional_license String
  recidency_hospital   String
  specialty            String
  citas_doctor         doctor_appointment[]
  doctor_urgency       doctor_urgency[]

  person    person @relation(fields: [person_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  person_id Int

  created_at DateTime @default(now())
  updated_at DateTime @updatedAt
}

model urgency {
  id               Int              @id @default(autoincrement())
  start_day        DateTime?        @db.Timestamp(0)
  end_day          DateTime?        @db.Timestamp(0)
  reason           String           @db.Text
  description      String           @db.LongText
  hospital         String
  address          String
  severity         String
  city             String
  person_id        Int
  created_at       DateTime         @default(now())
  updated_at       DateTime         @updatedAt
  doctor_urgencias doctor_urgency[]
}

enum person_sex {
  M
  F
}

enum person_marital_status {
  S
  C
  D
  V
}
